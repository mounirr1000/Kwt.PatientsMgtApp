@using Kwt.PatientsMgtApp.Core.Models
@using Kwt.PatientsMgtApp.WebUI.Infrastructure
@{
    var patient = (PatientModel)TempData["searchedPatient"] ?? new PatientModel();
}



    <div class="org-container">

        <div class="panel-group org-bar">
            <div id="panelbar" class="panel panel-default org-bar">
                <div class="panel-heading org-bar">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" href="#collapse1"><span class="p-2">@patient.Name</span> <i class="fa fa-angle-down"></i></a>
                    </h4>

                </div>
                <div id="collapse1" class="panel-collapse collapse">
                    <div class="panel-body">
                        <div class="row">
                            <div class="org-col-md-3">
                                <label>Patient Info</label>
                                <div id="searchedPatientDetail"></div>
                                @*<table>
                                    <tr>
                                        <td class="title">Agency:</td>
                                        <td>@patient.Agency</td>
                                    </tr>
                                    <tr>
                                        <td class="title">Doctor:</td>
                                        <td>@patient.Doctor</td>
                                    </tr>
                                    <tr>
                                        <td class="title">First Appointment Date:</td>
                                        <td>@patient.FirstApptDAte</td>
                                    </tr>
                                    <tr>
                                        <td class="title">Hospital:</td>
                                        <td>@patient.Hospital</td>
                                    </tr>
                                </table>*@
                            </div>
                            <div class="org-col-md-4">
                                <label>Benefeciary Info</label>
                                <div id="searchedPatientBenefeciary"></div>
                                @*<table>
                                    <tr>
                                        <td class="title">Active Status</td>
                                        <td>
                                            @if (patient.IsActive)
                                            {
                                                <span style="color: Green"> Yes </span>
                                            }
                                            else
                                            {
                                                <span style="color: red"> No </span>
                                            }
                                            
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="title">Beneficiary Status:</td>
                                        <td>
                                            @if (patient.IsBeneficiary)
                                            {
                                                <span style="color: Green"> Yes </span>
                                            }
                                            else
                                            {
                                                <span style="color: red"> No </span>
                                            }
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="title">Kuwait Phone</td>
                                        <td>@patient.KWTPhone</td>
                                    </tr>
                                    <tr>
                                        <td class="title">Specialty</td>
                                        <td>@patient.Specialty</td>
                                    </tr>
                                </table>*@

                            </div>
                            <div class="org-col-md-3">
                                <label>History of Last 3 Payments:</label>
                                <div id="searchedPatientPayment"></div>
                                @*<table>
                                    <tr>
                                        <td class="title">Us Phone/Hospital Phone:</td>
                                        <td>@patient.USPhone</td>
                                    </tr>
                                    <tr>
                                        <td class="title">End Treatment Date</td>
                                        <td>@patient.EndTreatDate</td>
                                    </tr>
                                </table>*@

                            </div>
                            @if (User.IsInAnyRoles("Admin", "Super Admin", "Accountant", "Auditor")) {
                            <div class="org-col-md-3">
                                @*<table>
                                    <tr>
                                        <td class="title">Bank:</td>
                                        <td>@patient.BankName</td>
                                    </tr>
                                    <tr>
                                        <td class="title">Bank Code:</td>
                                        <td>@patient.BankCode</td>
                                    </tr>
                                    <tr>
                                        <td class="title">IBan</td>
                                        <td>@patient.Iban</td>
                                    </tr>
                                   
                                    <tr>
                                        <td class="title">Bank:</td>
                                        <td>@patient.BankName</td>
                                    </tr>
                                    <tr>
                                        <td class="title">Bank Code:</td>
                                        <td>@patient.BankCode</td>
                                    </tr>
                                    <tr>
                                        <td class="title">IBan</td>
                                        <td>@patient.Iban</td>
                                    </tr>
                                </table>*@

                            </div>
                            }
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

@section Scripts {

    @*<script src="https://kendo.cdn.telerik.com/2018.2.516/js/pako_deflate.min.js"></script>

    <script type="text/javascript">
        var data = @Html.Raw(Json.Encode(patient));
        console.log(data);
        $('document').ready(function () {

            var data = @Html.Raw(Json.Encode(patient));
            console.log(data);
            var isAdmin =   @Html.Raw(Json.Encode(User.IsInRole("Admin")));
            function getTemplate(paymentId) {
                if (isAdmin) {
                    return '<a href="javascript:confirmDelete('+paymentId+','+'\'paymentId\''+')" id='+paymentId+'> <i class="fa fa-times fa-2x" style="color: lightcoral"></i></a>';
                }
                return '';
            }
            var grid =  $("#patientDetail").kendoGrid({
                resizable: true,

                columns: [{
                    field: "Id",
                    title: "Voucher#",

                    template: "<a href='@Url.Action("Details", "Payment")?paymentId=#= Id#'>#= Id #</a>"

                },
                {
                    field: "PaymentDateFormatted",
                    title: "Payment Date"
                },
                {
                    field: "PatientCID",
                    title: "P_CID"
                },
                {
                    field: "CompanionCID",
                    title: "C_CID"
                },

                {
                    field: "PaymentStartDateFormatted",
                    title: "From"

                },
                {
                    field: "PaymentEndDateFormatted",
                    title: "To"

                },
                {
                    field: "TotalDue",
                    title: "Final Amount"
                },{
                    field: "Id",
                    title: "Delete",
                    template: getTemplate('#=Id#'),
                    hidden: !isAdmin
                }],
                dataSource: {
                    data: data
                }
            }).data("kendoGrid");
        });
    </script>*@
}